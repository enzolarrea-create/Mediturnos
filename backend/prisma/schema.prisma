// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Rol {
  PACIENTE
  MEDICO
  SECRETARIO
  ADMINISTRADOR
}

enum EstadoTurno {
  PENDIENTE
  CONFIRMADO
  CANCELADO
  AUSENTE
  COMPLETADO
}

model Usuario {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  rol       Rol
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones
  paciente   Paciente?
  medico     Medico?
  secretario Secretario?
  notificaciones Notificacion[]

  @@map("usuarios")
}

model Paciente {
  id              String    @id @default(uuid())
  usuarioId       String    @unique
  nombre          String
  apellido        String
  dni             String    @unique
  fechaNacimiento DateTime
  telefono        String?
  direccion       String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relaciones
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  turnos  Turno[]

  @@map("pacientes")
}

model Medico {
  id        String   @id @default(uuid())
  usuarioId String   @unique
  nombre    String
  apellido  String
  matricula String   @unique
  telefono  String?
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones
  usuario         Usuario            @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  especialidades  MedicoEspecialidad[]
  disponibilidades Disponibilidad[]
  turnos          Turno[]
  notasMedicas    NotaMedica[]

  @@map("medicos")
}

model Secretario {
  id        String   @id @default(uuid())
  usuarioId String   @unique
  nombre    String
  apellido  String
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("secretarios")
}

model Especialidad {
  id          String   @id @default(uuid())
  nombre      String   @unique
  descripcion String?
  activa      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relaciones
  medicos MedicoEspecialidad[]

  @@map("especialidades")
}

model MedicoEspecialidad {
  id             String      @id @default(uuid())
  medicoId       String
  especialidadId String
  createdAt      DateTime    @default(now())

  // Relaciones
  medico       Medico       @relation(fields: [medicoId], references: [id], onDelete: Cascade)
  especialidad Especialidad @relation(fields: [especialidadId], references: [id], onDelete: Cascade)

  @@unique([medicoId, especialidadId])
  @@map("medico_especialidades")
}

model Disponibilidad {
  id         String   @id @default(uuid())
  medicoId   String
  diaSemana  Int      // 0 = Domingo, 1 = Lunes, ..., 6 = SÃ¡bado
  horaInicio String   // Formato "HH:MM"
  horaFin    String   // Formato "HH:MM"
  activo     Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relaciones
  medico Medico @relation(fields: [medicoId], references: [id], onDelete: Cascade)

  @@map("disponibilidades")
}

model Turno {
  id             String       @id @default(uuid())
  pacienteId     String
  medicoId       String
  fecha          DateTime
  hora           String       // Formato "HH:MM"
  estado         EstadoTurno @default(PENDIENTE)
  motivoConsulta String?
  observaciones  String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // Relaciones
  paciente    Paciente    @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  medico      Medico      @relation(fields: [medicoId], references: [id], onDelete: Cascade)
  notasMedicas NotaMedica[]

  @@index([pacienteId])
  @@index([medicoId])
  @@index([fecha])
  @@map("turnos")
}

model NotaMedica {
  id        String   @id @default(uuid())
  turnoId   String
  medicoId String
  contenido String
  fecha     DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones
  turno Turno @relation(fields: [turnoId], references: [id], onDelete: Cascade)
  medico Medico @relation(fields: [medicoId], references: [id], onDelete: Cascade)

  @@map("notas_medicas")
}

model Notificacion {
  id        String   @id @default(uuid())
  usuarioId String
  tipo      String   // "TURNO_CREADO", "TURNO_CANCELADO", "TURNO_CONFIRMADO", etc.
  mensaje   String
  leida     Boolean  @default(false)
  createdAt DateTime @default(now())

  // Relaciones
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([usuarioId])
  @@map("notificaciones")
}

